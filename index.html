<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WYSIWYG HTML Editor</title>
    <!-- Tailwind CSS CDN for quick styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles to ensure full height and responsive layout */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow: hidden; /* Prevent body scroll, content will scroll within panels */
        }
        #app-container {
            height: 100vh; /* Full viewport height */
            display: flex;
            flex-direction: column; /* Stack vertically on small screens */
            @media (min-width: 1024px) { /* On large screens (lg breakpoint in Tailwind) */
                flex-direction: row; /* Arrange horizontally */
            }
        }
        .panel {
            flex: 1; /* Each panel takes equal space */
            display: flex;
            flex-direction: column;
            border-radius: 0.5rem; /* Rounded corners for panels */
        }
        textarea, iframe {
            flex: 1; /* Textarea and iframe fill their respective panels */
            width: 100%;
            height: 100%; /* Ensures they fill the panel height */
        }
        /* Specific styling for the iframe content to make it editable */
        iframe.editable-frame body {
            margin: 10px; /* Add some padding inside the iframe */
            min-height: calc(100% - 20px); /* Ensure body takes up most of the space for contenteditable */
            outline: none; /* Remove default focus outline */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">
    <div id="app-container" class="p-4 gap-4">
        <!-- Left Panel: HTML Code Editor -->
        <div class="panel bg-white shadow-lg rounded-lg p-4">
            <h2 class="text-xl font-semibold mb-3 text-center">HTML Source Code</h2>
            <textarea
                id="htmlCode"
                class="border border-gray-300 rounded-md p-3 text-base font-mono focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"
                placeholder="Paste your HTML code here..."
            >&lt;h1&gt;Welcome to the WYSIWYG Editor!&lt;/h1&gt;
&lt;p&gt;Edit this text directly in the preview panel.&lt;/p&gt;
&lt;button class=&quot;bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors duration-200&quot;&gt;Click Me!&lt;/button&gt;
&lt;ul&gt;
    &lt;li&gt;Item 1&lt;/li&gt;
    &lt;li&gt;Item 2&lt;/li&gt;
&lt;/ul&gt;
&lt;img src=&quot;https://placehold.co/300x150/lightblue/white?text=Placeholder+Image&quot; alt=&quot;Placeholder Image&quot; class=&quot;rounded-md mt-4&quot;&gt;</textarea>
            <div class="flex flex-col sm:flex-row gap-2 mt-4 justify-center">
                <button
                    id="renderButton"
                    class="bg-green-600 text-white px-5 py-2 rounded-md hover:bg-green-700 transition-colors duration-200 shadow-md flex-1"
                >
                    Render HTML
                </button>
                <button
                    id="syncButton"
                    class="bg-purple-600 text-white px-5 py-2 rounded-md hover:bg-purple-700 transition-colors duration-200 shadow-md flex-1"
                >
                    Sync HTML from Preview
                </button>
                <button
                    id="downloadButton"
                    class="bg-blue-600 text-white px-5 py-2 rounded-md hover:bg-blue-700 transition-colors duration-200 shadow-md flex-1"
                >
                    Download HTML
                </button>
            </div>
        </div>

        <!-- Right Panel: Rendered HTML Preview -->
        <div class="panel bg-white shadow-lg rounded-lg p-4 relative overflow-hidden">
            <h2 class="text-xl font-semibold mb-3 text-center">Live Preview (Editable)</h2>
            <iframe
                id="previewFrame"
                class="editable-frame border border-gray-300 rounded-md bg-white"
                sandbox="allow-same-origin allow-scripts allow-forms allow-modals"
            ></iframe>
            <!-- Message Box for user feedback -->
            <div id="messageBox" class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-sm px-4 py-2 rounded-full shadow-lg opacity-0 transition-opacity duration-300">
                <!-- Messages will appear here -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Get references to the HTML elements
            const htmlCodeTextArea = document.getElementById('htmlCode');
            const previewFrame = document.getElementById('previewFrame');
            const renderButton = document.getElementById('renderButton');
            const syncButton = document.getElementById('syncButton');
            const downloadButton = document.getElementById('downloadButton'); // New button reference
            const messageBox = document.getElementById('messageBox');

            // Function to display messages to the user
            function showMessage(message, duration = 3000) {
                messageBox.textContent = message;
                messageBox.classList.remove('opacity-0');
                messageBox.classList.add('opacity-100');
                setTimeout(() => {
                    messageBox.classList.remove('opacity-100');
                    messageBox.classList.add('opacity-0');
                }, duration);
            }

            // Function to render the HTML from the textarea into the iframe
            function updatePreview() {
                try {
                    // Get the HTML content from the textarea
                    const htmlContent = htmlCodeTextArea.value;

                    // Write the HTML into the iframe's document
                    // We include a basic HTML structure and some default body styling for better rendering
                    const iframeDoc = previewFrame.contentWindow.document;
                    iframeDoc.open();
                    iframeDoc.write(`
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <style>
                                /* Basic styles for the iframe content to prevent default margins/padding */
                                body {
                                    margin: 0;
                                    padding: 10px;
                                    box-sizing: border-box;
                                    font-family: 'Inter', sans-serif; /* Consistent font */
                                    line-height: 1.5;
                                }
                                /* Basic Tailwind-like reset for elements within the iframe */
                                * {
                                    box-sizing: border-box;
                                }
                                /* Ensure images within iframe are responsive */
                                img {
                                    max-width: 100%;
                                    height: auto;
                                    display: block; /* Remove extra space below image */
                                }
                            </style>
                        </head>
                        <body>
                            ${htmlContent}
                        </body>
                        </html>
                    `);
                    iframeDoc.close();

                    // Make the iframe content editable
                    // designMode='on' makes the entire document editable, allowing direct text editing
                    // This is the core of the WYSIWYG functionality.
                    iframeDoc.designMode = 'on';

                    showMessage('HTML rendered successfully! You can now edit the preview directly.', 3000);
                } catch (error) {
                    console.error('Error rendering HTML:', error);
                    showMessage('Error rendering HTML. Check console for details.', 5000);
                }
            }

            // Function to sync HTML from the iframe back to the textarea
            function syncFromPreview() {
                try {
                    // Get the innerHTML of the iframe's body, which contains the live edited content
                    const liveHtmlContent = previewFrame.contentWindow.document.body.innerHTML;

                    // Update the textarea's value with the content from the iframe
                    htmlCodeTextArea.value = liveHtmlContent;

                    showMessage('HTML synced from preview to source code.', 3000);
                } catch (error) {
                    console.error('Error syncing HTML from preview:', error);
                    showMessage('Error syncing HTML. Make sure the preview is loaded.', 5000);
                }
            }

            // New function to download the HTML code
            function downloadHtml() {
                try {
                    // Get the HTML content from the textarea
                    const htmlContent = htmlCodeTextArea.value;
                    const filename = 'my_editable_page.html';

                    // Create a Blob from the HTML content
                    const blob = new Blob([htmlContent], { type: 'text/html' });

                    // Create a temporary anchor element
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob); // Create a URL for the blob
                    a.download = filename; // Set the download filename

                    // Append the anchor to the body (not visible) and click it to trigger download
                    document.body.appendChild(a);
                    a.click();

                    // Clean up: remove the anchor and revoke the object URL
                    document.body.removeChild(a);
                    URL.revokeObjectURL(a.href);

                    showMessage(`'${filename}' downloaded successfully!`, 3000);
                } catch (error) {
                    console.error('Error downloading HTML:', error);
                    showMessage('Error downloading HTML. Check console for details.', 5000);
                }
            }

            // Event Listeners
            // Render button click
            renderButton.addEventListener('click', updatePreview);

            // Sync button click
            syncButton.addEventListener('click', syncFromPreview);

            // Download button click (NEW)
            downloadButton.addEventListener('click', downloadHtml);

            // Initial render when the page loads with the default content
            updatePreview();
        });
    </script>
</body>
</html>
