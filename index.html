<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced WYSIWYG Editor</title>
    
    <!-- Dynamically loaded Google Fonts will be inserted here by JavaScript -->

    <style>
        /* ------------------- */
        /* --- Global Styles & Variables --- */
        /* ------------------- */
        :root {
            --primary-color: #007bff;
            --primary-hover-color: #0056b3;
            --border-color: #ddd;
            --background-color: #f8f9fa;
            --text-color: #212529;
            --toolbar-bg: #fff;
            --modal-overlay-bg: rgba(0, 0, 0, 0.6);
            --modal-content-bg: #fff;
            --font-preview-hover: #e9ecef;
            --default-font: 'Helvetica', 'Arial', sans-serif;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--default-font);
            background-color: var(--background-color);
            color: var(--text-color);
            padding: 1rem;
            line-height: 1.6;
        }

        /* ------------------- */
        /* --- Editor Layout --- */
        /* ------------------- */
        .editor-container {
            max-width: 900px;
            margin: 2rem auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            padding: 0.5rem;
            background-color: var(--toolbar-bg);
            border-bottom: 1px solid var(--border-color);
            gap: 0.25rem;
        }

        .toolbar-group {
            display: flex;
            margin-right: 0.5rem;
            padding-right: 0.5rem;
            border-right: 1px solid var(--border-color);
        }
        .toolbar-group:last-child {
            border-right: none;
        }

        .toolbar button, .toolbar select {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            margin: 0 0.1rem;
            border-radius: 4px;
            transition: background-color 0.2s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 38px;
            height: 38px;
        }

        .toolbar button:hover, .toolbar select:hover {
            background-color: var(--font-preview-hover);
        }

        .toolbar button.active {
            background-color: #dbeafe; /* A light blue to indicate active state */
            color: var(--primary-color);
        }

        .toolbar select {
            -webkit-appearance: none;
            appearance: none;
            width: auto;
            padding: 0.5rem 0.75rem;
        }

        #editor {
            min-height: 400px;
            padding: 1.5rem;
            outline: none;
            font-size: 16px;
            line-height: 1.7;
            overflow-y: auto;
        }

        #editor:focus {
            box-shadow: inset 0 0 0 2px var(--primary-color);
        }

        /* Styles for content within the editor */
        #editor h1, #editor h2, #editor h3 {
            margin-bottom: 1rem;
            line-height: 1.3;
        }

        /* ------------------- */
        /* --- Font Family Modal --- */
        /* ------------------- */
        .modal {
            display: none; /* Initially hidden */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: var(--modal-overlay-bg);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: var(--modal-content-bg);
            margin: 10% auto;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            animation: slideIn 0.4s ease;
        }

        .modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.25rem;
        }

        .close-button {
            font-size: 1.75rem;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            border: none;
            background: none;
            padding: 0 0.5rem;
        }

        .close-button:hover,
        .close-button:focus {
            color: var(--text-color);
        }

        .modal-body {
            padding: 1rem;
            flex-grow: 1;
        }
        
        #font-list {
            max-height: 40vh; /* Limits height, makes it scrollable */
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .font-item {
            padding: 0.75rem 1.25rem;
            border: none;
            width: 100%;
            text-align: left;
            background: none;
            font-size: 1.2rem;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s ease;
        }
        .font-item:last-child {
            border-bottom: none;
        }

        .font-item:hover {
            background-color: var(--font-preview-hover);
        }

        .font-item.selected {
            background-color: #dbeafe;
            font-weight: bold;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            background-color: #f9f9f9;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
        }

        .modal-footer button {
            padding: 0.6rem 1.2rem;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        #setDefaultFontBtn {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        #setDefaultFontBtn:hover {
             background-color: var(--primary-hover-color);
             border-color: var(--primary-hover-color);
        }
        
        #cancelFontBtn {
            background-color: #fff;
        }
        #cancelFontBtn:hover {
            background-color: #f1f1f1;
        }


        /* ------------------- */
        /* --- Animations --- */
        /* ------------------- */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* ------------------- */
        /* --- Responsive Design --- */
        /* ------------------- */
        @media (max-width: 768px) {
            body { padding: 0.5rem; }
            .editor-container { margin: 1rem auto; }
            .toolbar { padding: 0.5rem; }
            .toolbar-group { padding-right: 0.25rem; margin-right: 0.25rem; }
            .toolbar button, .toolbar select { width: 34px; height: 34px; font-size: 0.9rem; padding: 0.4rem; }
            .modal-content { margin: 5% auto; width: 95%; }
            #editor { padding: 1rem; min-height: 300px; }
        }

    </style>
</head>
<body>

    <div class="editor-container">
        <!-- Toolbar for formatting controls -->
        <div class="toolbar">
            <div class="toolbar-group">
                <button data-command="bold" aria-label="Bold"><b>B</b></button>
                <button data-command="italic" aria-label="Italic"><i>I</i></button>
                <button data-command="underline" aria-label="Underline"><u>U</u></button>
                <button data-command="strikethrough" aria-label="Strikethrough"><s>S</s></button>
            </div>

            <div class="toolbar-group">
                <button data-command="insertUnorderedList" aria-label="Unordered List">•≡</button>
                <button data-command="insertOrderedList" aria-label="Ordered List">1.≡</button>
            </div>
            
            <div class="toolbar-group">
                <button id="fontFamilyBtn" aria-label="Choose Font Family">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 7 4 4 20 4 20 7"></polyline><line x1="9" y1="20" x2="15" y2="20"></line><line x1="12" y1="4" x2="12" y2="20"></line></svg>
                </button>
            </div>

             <div class="toolbar-group">
                <select id="formatBlock" aria-label="Format Block">
                    <option value="p">Paragraph</option>
                    <option value="h1">Heading 1</option>
                    <option value="h2">Heading 2</option>
                    <option value="h3">Heading 3</option>
                </select>
            </div>
        </div>

        <!-- The editable content area -->
        <div id="editor" contenteditable="true" spellcheck="true" role="textbox" aria-multiline="true">
            <h1>Welcome to Your Advanced Editor!</h1>
            <p>This is a fully functional What-You-See-Is-What-You-Get (WYSIWYG) editor built with vanilla JavaScript. You can <b>bold text</b>, make it <i>italic</i>, or <u>underline</u> it.</p>
            <p>The key feature is the font family selector. Click the 'T' icon in the toolbar to open a dialog. You'll see a list of Google Fonts, each displayed in its own style. Select one to apply it to your text, or set it as the default for all new content.</p>
            <ul>
                <li>Create lists with ease.</li>
                <li>Change block formats from paragraph to headings.</li>
                <li>Everything is mobile-first and fully responsive.</li>
            </ul>
        </div>
    </div>
    
    <!-- Font Family Modal -->
    <div id="fontFamilyModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-content">
            <header class="modal-header">
                <h2 id="modalTitle">Choose a Font Family</h2>
                <button class="close-button" aria-label="Close dialog">×</button>
            </header>
            <div class="modal-body">
                <div id="font-list" role="listbox">
                    <!-- Font items will be dynamically inserted here -->
                </div>
            </div>
            <footer class="modal-footer">
                <button id="cancelFontBtn">Cancel</button>
                <button id="setDefaultFontBtn">Set as Default</button>
            </footer>
        </div>
    </div>

    <script>
    // Self-invoking function to prevent polluting the global namespace
    (() => {
        "use strict";

        // --- 1. CONFIGURATION & DATA ---

        /**
         * A curated list of popular Google Fonts.
         * 'name' is for display.
         * 'family' is the exact CSS font-family value.
         * 'urlName' is the name used in the Google Fonts API URL.
         */
        const GOOGLE_FONTS = [
            { name: 'Roboto', family: '"Roboto", sans-serif', urlName: 'Roboto' },
            { name: 'Open Sans', family: '"Open Sans", sans-serif', urlName: 'Open+Sans' },
            { name: 'Lato', family: '"Lato", sans-serif', urlName: 'Lato' },
            { name: 'Montserrat', family: '"Montserrat", sans-serif', urlName: 'Montserrat' },
            { name: 'Oswald', family: '"Oswald", sans-serif', urlName: 'Oswald' },
            { name: 'Source Sans Pro', family: '"Source Sans Pro", sans-serif', urlName: 'Source+Sans+Pro' },
            { name: 'Merriweather', family: '"Merriweather", serif', urlName: 'Merriweather' },
            { name: 'PT Sans', family: '"PT Sans", sans-serif', urlName: 'PT+Sans' },
            { name: 'Playfair Display', family: '"Playfair Display", serif', urlName: 'Playfair+Display' },
            { name: 'Nunito', family: '"Nunito", sans-serif', urlName: 'Nunito' },
            { name: 'Raleway', family: '"Raleway", sans-serif', urlName: 'Raleway' },
            { name: 'Poppins', family: '"Poppins", sans-serif', urlName: 'Poppins' },
            { name: 'Roboto Mono', family: '"Roboto Mono", monospace', urlName: 'Roboto+Mono' },
            { name: 'Inconsolata', family: '"Inconsolata", monospace', urlName: 'Inconsolata' },
            { name: 'Lobster', family: '"Lobster", cursive', urlName: 'Lobster' },
            { name: 'Dancing Script', family: '"Dancing Script", cursive', urlName: 'Dancing+Script' },
        ];
        
        let activeSelection = null; // To store the user's text selection
        let selectedFontInModal = null; // To track which font is selected in the modal

        // --- 2. DOM ELEMENT REFERENCES ---

        const editor = document.getElementById('editor');
        const toolbar = document.querySelector('.toolbar');
        const formatBlockSelect = document.getElementById('formatBlock');
        
        // Modal elements
        const fontFamilyBtn = document.getElementById('fontFamilyBtn');
        const modal = document.getElementById('fontFamilyModal');
        const fontList = document.getElementById('font-list');
        const closeModalBtn = modal.querySelector('.close-button');
        const cancelFontBtn = document.getElementById('cancelFontBtn');
        const setDefaultFontBtn = document.getElementById('setDefaultFontBtn');

        // --- 3. CORE LOGIC & FUNCTIONS ---

        /**
         * Executes a formatting command on the selected text.
         * @param {string} command - The command to execute (e.g., 'bold').
         * @param {string|null} value - The value for commands that require one (e.g., 'fontName').
         */
        const formatDoc = (command, value = null) => {
            // Restore selection before executing command, vital for modal interaction
            if (activeSelection) {
                const sel = window.getSelection();
                sel.removeAllRanges();
                sel.addRange(activeSelection);
            }
            document.execCommand(command, false, value);
            editor.focus(); // Return focus to the editor
            updateToolbarState(); // Update button states after command
        };
        
        /**
         * Updates the toolbar button states (e.g., 'active' class) based on the current selection.
         */
        const updateToolbarState = () => {
            const buttons = toolbar.querySelectorAll('button[data-command]');
            buttons.forEach(button => {
                const command = button.dataset.command;
                if (document.queryCommandState(command)) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
        };

        /**
         * Dynamically loads all Google Fonts from the curated list by injecting a <link> tag.
         * This is efficient as it makes a single HTTP request.
         */
        const loadGoogleFonts = () => {
            const fontUrl = `https://fonts.googleapis.com/css2?${GOOGLE_FONTS.map(f => `family=${f.urlName}`).join('&')}&display=swap`;
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = fontUrl;
            document.head.appendChild(link);
        };
        
        /**
         * Populates the font list in the modal.
         * Each font name is styled with its own font-family.
         */
        const populateFontList = () => {
            fontList.innerHTML = ''; // Clear any existing items
            GOOGLE_FONTS.forEach(font => {
                const item = document.createElement('button');
                item.className = 'font-item';
                item.textContent = font.name;
                item.style.fontFamily = font.family;
                item.dataset.fontFamily = font.family;
                item.setAttribute('role', 'option');
                
                item.addEventListener('click', () => {
                    // Apply font immediately on click
                    formatDoc('fontName', font.family);
                    closeModal();
                });

                item.addEventListener('mousedown', (e) => {
                    // When an item is clicked, track it for the "Set as Default" button
                    if (selectedFontInModal) {
                        selectedFontInModal.classList.remove('selected');
                    }
                    selectedFontInModal = item;
                    item.classList.add('selected');
                });
                
                fontList.appendChild(item);
            });
        };
        
        // --- 4. MODAL HANDLING ---
        
        /**
         * Opens the font family modal.
         */
        const openModal = () => {
            // Store current selection, as it's lost when modal is focused
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                activeSelection = selection.getRangeAt(0).cloneRange();
            }
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        };
        
        /**
         * Closes the font family modal.
         */
        const closeModal = () => {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore scrolling
            activeSelection = null; // Clear saved selection
            if (selectedFontInModal) {
                selectedFontInModal.classList.remove('selected');
                selectedFontInModal = null;
            }
        };

        // --- 5. EVENT LISTENERS ---

        /**
         * Initializes all event listeners for the editor.
         */
        const initializeEventListeners = () => {
            // Listener for toolbar buttons (bold, italic, etc.) using event delegation
            toolbar.addEventListener('click', (e) => {
                const button = e.target.closest('button[data-command]');
                if (button) {
                    formatDoc(button.dataset.command);
                }
            });
            
            // Listener for the Heading/Paragraph dropdown
            formatBlockSelect.addEventListener('change', (e) => {
                formatDoc('formatBlock', e.target.value);
            });

            // Listen for selection changes to update the toolbar
            document.addEventListener('selectionchange', updateToolbarState);
            editor.addEventListener('keyup', updateToolbarState);
            editor.addEventListener('mouseup', updateToolbarState);
            
            // --- Modal Event Listeners ---
            fontFamilyBtn.addEventListener('click', openModal);
            closeModalBtn.addEventListener('click', closeModal);
            cancelFontBtn.addEventListener('click', closeModal);
            
            // Close modal if user clicks outside of the content area
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });

            // Close modal with Escape key for accessibility
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modal.style.display === 'block') {
                    closeModal();
                }
            });

            // Listener for the "Set as Default" button
            setDefaultFontBtn.addEventListener('click', () => {
                if (selectedFontInModal) {
                    const defaultFontFamily = selectedFontInModal.dataset.fontFamily;
                    editor.style.fontFamily = defaultFontFamily;
                    console.log(`Default font set to: ${defaultFontFamily}`);
                    closeModal();
                } else {
                    alert('Please select a font from the list first.');
                }
            });
        };

        // --- 6. INITIALIZATION ---

        /**
         * Main function to set up the editor.
         */
        const init = () => {
            // Make sure the document is ready before we do anything
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
                return;
            }
            
            // Set default paragraph format for browsers that might use <div> on Enter
            document.execCommand('defaultParagraphSeparator', false, 'p');

            loadGoogleFonts();
            populateFontList();
            initializeEventListeners();
            
            editor.focus();
            console.log("WYSIWYG Editor Initialized.");
        };
        
        // Start the application
        init();

    })();
    </script>

</body>
</html>
